# 8086 CPU :star:
> 记得补一个Intel CPU的发展史 :alien: 

:runner::runner::runner:
# 8086CPU内部寄存器  
对于汇编语言的编写，CPU中可以使用的资源也就是寄存器，可以用过指令读取寄存器的值。  
8086CPU内部总共有14个寄存器，均为16位。  
分为三类：通用寄存器、控制寄存器、段寄存器  

## 三类寄存器
---
### 通用寄存器  

|数据寄存器|位数|功能|
|:---:|:---:|:---:|
|AX (Accumulator)|16|累加器|
|BX(Base)|16|基地址寄存器|
|CX(Count)|16|计数器寄存器|
|DX(Data)|16|数据寄存器|
|**指针寄存器**|位数|功能|
|SP(Stack Pointer)|16|堆栈指针寄存器|
|BP(Base Pointer)|16|基指针寄存器|
|**变址寄存器**|位数|功能|
|SI(Source Index)|16|源变址寄存器|
|DI(Destination Indes)|16|目的变址寄存器|

### 控制寄存器

|控制寄存器|位数|功能|
|:---:|:---:|:---:|
|IP(Instruction Pointer)|16|指令指针寄存器|
|FLAG|16|标志寄存器|



### 段寄存器

|段寄存器|位数|功能|
|:---:|:---:|:---:|
|CS(Code Segment)|16|代码段寄存器|
|DS(Data Segment)|16|数据段寄存器|
|SS(Stack Segment)|16|堆栈寄存器|
|ES(Extra Segment)|16|附加段寄存器|

----
### 通用寄存器介绍
由于在8086之前的CPU为8位CPU，所以为了兼容之前的8位程序  
在8086CPU中，每一个数据寄存器都可以当成两个8位的寄存器来使用。  
>只有4个数据寄存器可以分为两个8位的寄存器使用，其它寄存器不可以。  

|名称|高8位|低8位|
|:---:|:---:|:---:|
|AX|AH|AL|
|BX|BH|BL|
|CX|CH|CL|
|DX|DH|DL|

AX用于加减乘除指令。  
BX用于偏移地址取值。  
CX用于循环指令LOOP。  
DX配合AX指令计算用。  
BP存放偏移量，默认段是SS。  
SP默认段是？？？  


>8086CPU 中只有BX,SI,DI,BP可以以[x]的方式使用。

---  
### FLAG寄存器介绍 

|15|14|13|12|11|10|9|8|7|6|5|4|3|2|1|0|
|:---:|:---:|:---:||:---:|:---:|:---:||:---:|:---:|:---:||:---:|:---:|:---:||:---:|:---:|:---:|:---:|  
|  |  |  |  |OF|DF|IF|TF|SF|ZF| |AF| |PF| |CF|
|  |  |  |  |溢出标志|方向标志(控制SI,DI自增还是自减)|中断允许标志|追踪标志|符号标志(结果是否为负数)|零标志|  |辅助进位标志| |奇偶标志(记录运算结果的所有位中1的个数是否为偶数)| |进位标志|

|标志位名称|值为1时的标记|值为0时的标记|
|:---:|:---:|:---:|
|OF|OV|NV|
|SF|NG|PL|
|ZF|ZR|NZ|
|PF|PE|PO|
|CF|CY|NC|
|DF|DN|UP|

---

## 数据传送类指令
### 通用数据传送
#### MOV指令
* 指令格式：MOV,DES,SUR
* 功能： 将源操作数传送给目标操作数

    MOV AL,BH ;通用寄存器之间传送字节数据  
    MOV DS,AX ;通用寄存器和段寄存器传送数据(**段寄存器不能是CS**)  
    MOV AX,1234H ;立即数传送到通用寄存器  
    MOV DX,BUFFER ;通用寄存器和内存传送数据  
    ![操作数要求](./images/MOV.png)   
#### XCHG指令
* 指令格式：XCHG OPRD1,OPRD2
* 功能：将OPRD1和OPRD2交换
    MOV AX,1234H
    MOV BX,5678H
    XCHG AX,BX   ;通用寄存器之间交换数据
    XCHG AX,[100];寄存器和内存交换数据
> 两个操作数即使源操作数又是目的操作数，细节可以根据MOV的操作数要求。

#### XLAT 查表指令
* 指令格式：XLAT
* 指令功能：完成一个字节的查表转换，将数据段中偏移地址为BX/EBX/RBX与AL寄存器之和的存储单元内容送到AL  即[BX+AL]->AL。 
    MOV BX,0100H ;  DS:0100H
    MOV AL,05H
    XLAT     ;DS:0105H的一个字节内容送到AL中

### 堆栈操作指令
#### PUSH  
* 指令格式：PUSH REG/MEM/IMM/SEG
* 指令功能：① SP-N->SP ② 源操作数圧入堆栈(N为操作数的字节数)

#### POP
* 指令格式：POP REG/MEM/SEG
* 指令功能：① 从栈顶弹出操作数 ② SP+N->SP

> 8086中的栈是固定大小的，栈底在低端，栈顶的高端，压栈时从栈顶向栈底扩散。

#### 新增的PUSH/POP指令
##### 80286新增PUSHA/POPA
* 指令格式：PUSHA/POPA 
* 指令功能：将所有通用寄存器的内容圧入堆栈，顺序是：AX CX DX BX SP BP SI DI
POPA出栈顺序相反(弹出到SP的值被丢弃)。
##### 80386新增PUSHAD/POPAD
* 指令格式：PUSHAD/POPAD
* 指令功能：将所有扩展通用寄存器的内容圧入堆栈，顺序是：EAX ECX EDX EBX ESP EBP ESI EDI
POPAD出栈顺序相反(弹出到ESP的值被丢弃).

### 地址传送指令
#### LEA 有效地址传送指令(Load Effective Address)
* 指令格式：LEA REG,MEM
* 指令功能：将源操作数在当前段内的有效地址(地址偏移量)传送到目标操作数。

    MOV DI,LISTS  ;变量LISTS的值传送给DI，DI=1234H
    LEA DX,LISTS  ;变量LISTS的偏移地址传送给DX
> MOV指令传送操作数的内容，LEA传送操作数的地址。

#### LDS/LES 地址指针传送指令
* 指令格式：LDS REG,MEM  LES REG,MEM
* 指令功能：都是将由源操作数偏移地址决定的双字（或三字）单元中的第一个（或前两个）字的内容送入指令指定的16位（或32位）通用寄存器，第二个（或第三个）字的内容传送给段寄存器DS或ES，这两个段寄存器是隐含的目的操作数。

    TAB1 DF 123456789ABCH ;定义TAB1为6字节数据
    TAB2 DD 56781234H      ;定义TAB2为4字节数据
    LDS BX,TAB1           ;9ABCH->BX,5678->DS
    LES SI,TAB2           ;1234H->SI,5678H->ES
> 只适用于16位或者32位地址模式，在64位地址下不能使用

### 标志位传送指令
#### LAHF/SAHF 标志寄存器读写指令
* 指令格式：LAHF/SAHF 
* 指令功能：LAHF将标志寄存器低字节读出后传送到AH寄存器，SAHF与LAHF相反。

#### PUSHF/POPF
* 指令格式：PUSHF/POPF
* 指令功能：将FLAG寄存器(2个字节)压到栈顶/弹出栈顶

### 输入/输出数据传送指令
#### IN/OUT 简单输入输出指令
* 指令格式：IN AL/AX,IMM8/DX  OUT IMM8/DX,AL/AX
* 指令功能：专门用于在AL或AX寄存器与I/O端口之间传送数据
    IN AX,30H   ;从端口30H输入16位数到AX
    MOV DX,300H
    IN AL,DX
    OUT 60H,AL
    OUT DX,AX  ;向300H端口输出16位数据

#### INS/OUTS 字符串输入输出指令
* 指令格式：INSB/INSW/INSD/OUTSB/OUTSW/OUTSD
* 指令功能：从(向)DX指定的端口输入(输出)一个字节/字/双字到ES:DI指定的内存单元。

>该指令因为用到DI寄存器，所以要DF标志位配合，若DF=0，则DI自增；DF=1,DI自减。


>IN或者OUT是相对于CPU来讲的，IN就是外部到CPU，OUT就是CPU到外部。















### BIOS & DOS 调用
* 格式： INT n
* 功能： 调用n对应的功能  

其中 n = 21H 是最为强大的 DOS 中断。一般调用中断须先将参数放入指定寄存器，功能号放入 AH，子功能号放入 AL。

|功能号(AH)|功能|参数|
|:---:|:---:|:---:|
|01H|输入一个字符|AL=输入字符的ASCII码|
|0AH|输入一个字符串|DS:DX=缓冲区首地址|
|02H|显示一个字符|AL=显示字符的ASCII码|
|09H|显示一个字符串|DS:DX=字符串首地址|

    MOV AH,09H
    MOV DX,string
    INT 21H

